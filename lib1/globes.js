var globes=function(){"use strict";function t(){return[µ.floorMod((new Date).getTimezoneOffset()/4,360),0]}function e(t,e){return _.isFinite(t)||t===1/0||t===-1/0?t:e}function r(t,r){var n=t[0],a=t[1],i=Math.max(Math.floor(e(n[0],0)),0),o=Math.max(Math.floor(e(n[1],0)),0),p=Math.min(Math.ceil(e(a[0],r.width)),r.width-1),c=Math.min(Math.ceil(e(a[1],r.height)),r.height-1);return{x:i,y:o,xMax:p,yMax:c,width:p-i+1,height:c-o+1}}function n(){return{projection:null,newProjection:function(t){throw new Error("method must be overridden")},bounds:function(t){return r(d3.geo.path().projection(this.projection).bounds({type:"Sphere"}),t)},fit:function(t){var e=this.newProjection(t),r=d3.geo.path().projection(e).bounds({type:"Sphere"}),n=(r[1][0]-r[0][0])/e.scale(),a=(r[1][1]-r[0][1])/e.scale();return.9*Math.min(t.width/n,t.height/a)},center:function(t){return[t.width/2,t.height/2]},scaleExtent:function(){return[25,3e3]},orientation:function(t,e){var r=this.projection,n=r.rotate();if(µ.isValue(t)){var a=t.split(","),i=+a[0],o=+a[1],p=+a[2],c=this.scaleExtent();return r.rotate(_.isFinite(i)&&_.isFinite(o)?[-i,-o,n[2]]:this.newProjection(e).rotate()),r.scale(_.isFinite(p)?µ.clamp(p,c[0],c[1]):this.fit(e)),r.translate(this.center(e)),this}return[(-n[0]).toFixed(2),(-n[1]).toFixed(2),Math.round(r.scale())].join(",")},manipulator:function(t,e){var r=this.projection,n=60/e,a=[r.rotate()[0]/n,-r.rotate()[1]/n],i=r.precision();return r.precision(10*i),{move:function(e,i){if(e){var o=e[0]-t[0]+a[0],p=e[1]-t[1]+a[1];r.rotate([o*n,-p*n,r.rotate()[2]])}r.scale(i)},end:function(){r.precision(i)}}},locate:function(t){return null},defineMask:function(t){return d3.geo.path().projection(this.projection).context(t)({type:"Sphere"}),t},defineMap:function(t,e){var r=d3.geo.path().projection(this.projection);t.append("defs").append("path").attr("id","sphere").datum({type:"Sphere"}).attr("d",r),t.append("use").attr("xlink:href","#sphere").attr("class","background-sphere"),t.append("path").attr("class","graticule").datum(d3.geo.graticule()).attr("d",r),t.append("path").attr("class","hemisphere").datum(d3.geo.graticule().minorStep([0,90]).majorStep([0,90])).attr("d",r),t.append("path").attr("class","coastline"),t.append("path").attr("class","lakes"),e.append("use").attr("xlink:href","#sphere").attr("class","foreground-sphere")}}}function a(t,e){var r=_.extend(n(),t);return r.projection=r.newProjection(e),r}function i(){return a({newProjection:function(){return d3.geo.mollweide().rotate([30,-45,90]).precision(.1)}})}function o(){return a({newProjection:function(){return d3.geo.azimuthalEquidistant().precision(.1).rotate([0,-90]).clipAngle(179.999)}})}function p(){return a({newProjection:function(){return d3.geo.conicEquidistant().rotate(t()).precision(.1)},center:function(t){return[t.width/2,t.height/2+.065*t.height]}})}function c(){return a({newProjection:function(){return d3.geo.equirectangular().rotate(t()).precision(.1)}})}function s(){return a({newProjection:function(){return d3.geo.orthographic().rotate(t()).precision(.1).clipAngle(90)},defineMap:function(t,e){var r=d3.geo.path().projection(this.projection),n=t.append("defs"),a=n.append("radialGradient").attr("id","orthographic-fill").attr("gradientUnits","objectBoundingBox").attr("cx","50%").attr("cy","49%").attr("r","50%");a.append("stop").attr("stop-color","#303030").attr("offset","69%"),a.append("stop").attr("stop-color","#202020").attr("offset","91%"),a.append("stop").attr("stop-color","#000005").attr("offset","96%"),n.append("path").attr("id","sphere").datum({type:"Sphere"}).attr("d",r),t.append("use").attr("xlink:href","#sphere").attr("fill","url(#orthographic-fill)"),t.append("path").attr("class","graticule").datum(d3.geo.graticule()).attr("d",r),t.append("path").attr("class","hemisphere").datum(d3.geo.graticule().minorStep([0,90]).majorStep([0,90])).attr("d",r),t.append("path").attr("class","coastline"),t.append("path").attr("class","lakes"),e.append("use").attr("xlink:href","#sphere").attr("class","foreground-sphere")},locate:function(t){return[-t[0],-t[1],this.projection.rotate()[2]]}})}function u(t){return a({newProjection:function(t){return d3.geo.stereographic().rotate([-43,-20]).precision(1).clipAngle(179.9999).clipExtent([[0,0],[t.width,t.height]])}},t)}function h(){return a({newProjection:function(){return d3.geo.polyhedron.waterman().rotate([20,0]).precision(.1)},defineMap:function(t,e){var r=d3.geo.path().projection(this.projection),n=t.append("defs");n.append("path").attr("id","sphere").datum({type:"Sphere"}).attr("d",r),n.append("clipPath").attr("id","clip").append("use").attr("xlink:href","#sphere"),t.append("use").attr("xlink:href","#sphere").attr("class","background-sphere"),t.append("path").attr("class","graticule").attr("clip-path","url(#clip)").datum(d3.geo.graticule()).attr("d",r),t.append("path").attr("class","coastline").attr("clip-path","url(#clip)"),t.append("path").attr("class","lakes").attr("clip-path","url(#clip)"),e.append("use").attr("xlink:href","#sphere").attr("class","foreground-sphere")}})}function d(){return a({newProjection:function(){return d3.geo.winkel3().precision(.1)}})}return d3.map({atlantis:i,azimuthal_equidistant:o,conic_equidistant:p,equirectangular:c,orthographic:s,stereographic:u,waterman:h,winkel3:d})}();